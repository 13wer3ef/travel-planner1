<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AIæ—…æ¸¸è§„åˆ’ç³»ç»Ÿ (DeepSeeké›†æˆç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .input-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .output-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 300px;
        }
        input, select, button {
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result-details {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>AIæ—…æ¸¸è§„åˆ’ç³»ç»Ÿ</h1>
        <p>åŸºäºDeepSeek AIçš„æ™ºèƒ½è¡Œç¨‹è§„åˆ’</p>
    </div>

    <div class="input-box">
        <h2>è¡Œç¨‹å‚æ•°è®¾ç½®</h2>
        <div>
            <label for="destination">ç›®çš„åœ°ï¼š</label>
            <input id="destination" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬">
        </div>
        <div>
            <label for="days">æ—…è¡Œå¤©æ•°ï¼š</label>
            <input type="number" id="days" placeholder="ä¾‹å¦‚ï¼š3">
        </div>
        <div>
            <label for="budget">æ€»é¢„ç®—ï¼ˆå…ƒï¼‰ï¼š</label>
            <input type="number" id="budget" placeholder="ä¾‹å¦‚ï¼š5000">
        </div>
        <div>
            <label for="people">å‡ºè¡Œäººæ•°ï¼š</label>
            <input id="people" placeholder="ä¾‹å¦‚ï¼š2å¤§1å°">
        </div>
        <div>
            <label for="preference">æ—…è¡Œåå¥½ï¼š</label>
            <select id="preference">
                <option value="family">äº²å­å®¶åº­</option>
                <option value="couple">æƒ…ä¾£å‡ºæ¸¸</option>
                <option value="friends">æœ‹å‹ç»“ä¼´</option>
                <option value="solo">ç‹¬è‡ªæ—…è¡Œ</option>
                <option value="elderly">é“¶å‘æ—…æ¸¸</option>
            </select>
        </div>
        <button onclick="generatePlan()">ç”Ÿæˆæ™ºèƒ½æ–¹æ¡ˆ</button>
    </div>

    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p>AIæ­£åœ¨è§„åˆ’æœ€ä½³è¡Œç¨‹...</p>
    </div>

    <div class="output-box" id="flowchart">
        <h2>AIè§„åˆ’ç»“æœ</h2>
        <p>è¯·å¡«å†™ä¸Šæ–¹å‚æ•°å¹¶ç‚¹å‡»"ç”Ÿæˆæ™ºèƒ½æ–¹æ¡ˆ"</p>
    </div>

    <script>
        // åˆå§‹åŒ–Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            flowchart: { useMaxWidth: false }
        });

        // æ¨¡æ‹ŸDeepSeek AI APIè°ƒç”¨
        async function callDeepSeekAPI(params) {
            // è¿™é‡Œæ˜¯æ¨¡æ‹ŸAPIå“åº”ï¼Œå®é™…é¡¹ç›®ä¸­åº”è¯¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨
            return new Promise(resolve => {
                setTimeout(() => {
                    const destinations = {
                        "åŒ—äº¬": ["æ•…å®«", "é•¿åŸ", "é¢å’Œå›­", "å¤©å›", "798è‰ºæœ¯åŒº"],
                        "ä¸Šæµ·": ["å¤–æ»©", "è¿ªå£«å°¼", "ä¸œæ–¹æ˜ç ", "è±«å›­", "å—äº¬è·¯"],
                        "æˆéƒ½": ["å¤§ç†ŠçŒ«åŸºåœ°", "å®½çª„å··å­", "éƒ½æ±Ÿå °", "é”¦é‡Œ", "é’åŸå±±"]
                    };

                    const dest = params.destination || "åŒ—äº¬";
                    const days = params.days || 3;
                    const budgetPerDay = (params.budget || 5000) / days;
                    const people = params.people || "2å¤§1å°";

                    // æ ¹æ®é¢„ç®—ç”Ÿæˆä¸åŒçº§åˆ«çš„æ–¹æ¡ˆ
                    let hotelLevel, mealLevel, transportLevel;
                    if (budgetPerDay < 800) {
                        hotelLevel = "ç»æµå‹é…’åº—";
                        mealLevel = "æœ¬åœ°å°åƒ";
                        transportLevel = "å…¬å…±äº¤é€š";
                    } else if (budgetPerDay < 1500) {
                        hotelLevel = "èˆ’é€‚å‹é…’åº—";
                        mealLevel = "ç‰¹è‰²é¤å…";
                        transportLevel = "ç½‘çº¦è½¦";
                    } else {
                        hotelLevel = "è±ªåé…’åº—";
                        mealLevel = "é«˜æ¡£é¤å…";
                        transportLevel = "åŒ…è½¦æœåŠ¡";
                    }

                    // æ ¹æ®åå¥½è°ƒæ•´æ™¯ç‚¹
                    let spots = destinations[dest] || destinations["åŒ—äº¬"];
                    if (params.preference === "family") {
                        spots = spots.filter(spot => !["é•¿åŸ", "éƒ½æ±Ÿå °"].includes(spot));
                        spots.unshift("å„¿ç«¥ä¹å›­", "ç§‘æŠ€é¦†");
                    } else if (params.preference === "elderly") {
                        spots = spots.filter(spot => !["è¿ªå£«å°¼", "798è‰ºæœ¯åŒº"].includes(spot));
                        spots.unshift("å…¬å›­æ™¨ç»ƒ", "èŒ¶é¦†");
                    }

                    // ç”Ÿæˆæ¯æ—¥è¡Œç¨‹
                    const dailyPlans = [];
                    for (let i = 0; i < days; i++) {
                        const daySpots = [];
                        const spotCount = Math.min(2 + Math.floor(Math.random() * 2), spots.length);

                        for (let j = 0; j < spotCount; j++) {
                            if (spots.length > 0) {
                                const randomIndex = Math.floor(Math.random() * spots.length);
                                daySpots.push(spots[randomIndex]);
                                spots.splice(randomIndex, 1);
                            }
                        }

                        dailyPlans.push({
                            day: i + 1,
                            morning: daySpots[0] || "è‡ªç”±æ´»åŠ¨",
                            afternoon: daySpots[1] || "å½“åœ°ä½“éªŒ",
                            evening: i === 0 ? "åŸå¸‚å¤œæ™¯" : "é…’åº—ä¼‘æ¯",
                            hotel: hotelLevel,
                            meals: mealLevel,
                            transport: transportLevel
                        });
                    }

                    resolve({
                        success: true,
                        destination: dest,
                        totalBudget: params.budget || 5000,
                        people: people,
                        preference: params.preference,
                        dailyPlans: dailyPlans,
                        tips: getRandomTips(params.preference)
                    });
                }, 1500); // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            });
        }

        function getRandomTips(preference) {
            const tips = {
                family: [
                    "å»ºè®®æºå¸¦å„¿ç«¥æ¨è½¦",
                    "æ™¯åŒºå¯èƒ½æœ‰äº²å­ä¼˜æƒ ç¥¨",
                    "é¢„ç•™åˆä¼‘æ—¶é—´"
                ],
                couple: [
                    "æ¨èæµªæ¼«é¤å…é¢„è®¢",
                    "å¤œæ™¯æ‹æ‘„ç‚¹å·²æ ‡è®°",
                    "ç‰¹è‰²æƒ…ä¾£ä½“éªŒé¡¹ç›®"
                ],
                friends: [
                    "æ¨èå›¢ä½“æ´»åŠ¨åœºæ‰€",
                    "å¤œç”Ÿæ´»åŒºåŸŸå·²æ ‡æ³¨",
                    "é€‚åˆæ‹ç…§çš„æ™¯ç‚¹"
                ],
                solo: [
                    "å•äººå®‰å…¨æ³¨æ„äº‹é¡¹",
                    "æ¨èç¤¾äº¤å‹é’æ—…",
                    "è‡ªåŠ©æ¸¸å®ç”¨ä¿¡æ¯"
                ],
                elderly: [
                    "æ— éšœç¢è®¾æ–½å·²ç­›é€‰",
                    "åŒ»ç–—ç‚¹ä½ç½®å·²æ ‡æ³¨",
                    "å»ºè®®å®‰æ’å……è¶³ä¼‘æ¯"
                ]
            };
            return tips[preference] || ["å»ºè®®æå‰æŸ¥çœ‹å¤©æ°”", "çƒ­é—¨æ™¯ç‚¹å¯æå‰é¢„çº¦"];
        }

        function generatePlan() {
            const destination = document.getElementById('destination').value;
            const days = document.getElementById('days').value;
            const budget = document.getElementById('budget').value;
            const people = document.getElementById('people').value;
            const preference = document.getElementById('preference').value;

            if (!destination || !days || !budget || !people) {
                alert("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ");
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').style.display = 'block';
            document.getElementById('flowchart').innerHTML = '<h2>AIè§„åˆ’ç»“æœ</h2>';

            // è°ƒç”¨æ¨¡æ‹ŸAPI
            callDeepSeekAPI({
                destination: destination,
                days: parseInt(days),
                budget: parseInt(budget),
                people: people,
                preference: preference
            }).then(response => {
                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('loading').style.display = 'none';

                if (response.success) {
                    renderResult(response);
                } else {
                    document.getElementById('flowchart').innerHTML = `
                        <h2>è§„åˆ’å¤±è´¥</h2>
                        <p>æŠ±æ­‰ï¼ŒAIè§„åˆ’é‡åˆ°é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚</p>
                    `;
                }
            });
        }

        function renderResult(data) {
            // ç”ŸæˆMermaidæµç¨‹å›¾
            const mermaidCode = `
                graph TD
                    A[è¾“å…¥å‚æ•°] -->|${data.destination} ${data.days}å¤© ${data.totalBudget}å…ƒ ${data.people}| B[DeepSeek AIåˆ†æ]
                    B --> C{æ™ºèƒ½å†³ç­–}
                    C -->|ç›®çš„åœ°ç‰¹è‰²| D[æ™¯ç‚¹æ¨è]
                    C -->|${data.preference}åå¥½| E[æ´»åŠ¨ä¼˜åŒ–]
                    C -->|é¢„ç®—åˆ†æ| F[ä½å®¿é¤é¥®]
                    D & E & F --> G["ğŸ“… å®Œç¾è¡Œç¨‹"]

                    style A fill:#6bf,stroke:#333
                    style B fill:#bbf,stroke:#333
                    style C fill:#f9f,stroke:#333
                    style G fill:#8f8,stroke:#090
            `;

            // ç”Ÿæˆè¯¦ç»†è¡Œç¨‹HTML
            let detailsHTML = '<div class="result-details"><h3>è¯¦ç»†è¡Œç¨‹å®‰æ’</h3>';
            detailsHTML += `<p><strong>ç›®çš„åœ°ï¼š</strong>${data.destination}</p>`;
            detailsHTML += `<p><strong>æ€»é¢„ç®—ï¼š</strong>${data.totalBudget}å…ƒ</p>`;
            detailsHTML += `<p><strong>å‡ºè¡Œäººæ•°ï¼š</strong>${data.people}</p>`;
            detailsHTML += `<p><strong>åå¥½è®¾ç½®ï¼š</strong>${document.getElementById('preference').options[document.getElementById('preference').selectedIndex].text}</p>`;

            detailsHTML += '<h4>æ¯æ—¥è®¡åˆ’ï¼š</h4>';
            data.dailyPlans.forEach(day => {
                detailsHTML += `
                    <div style="margin-bottom:15px;padding:10px;background:#eee;border-radius:5px;">
                        <h5>ç¬¬${day.day}å¤©</h5>
                        <p><strong>ä¸Šåˆï¼š</strong>${day.morning}</p>
                        <p><strong>ä¸‹åˆï¼š</strong>${day.afternoon}</p>
                        <p><strong>æ™šä¸Šï¼š</strong>${day.evening}</p>
                        <p><strong>ä½å®¿ï¼š</strong>${day.hotel}</p>
                        <p><strong>é¤é¥®ï¼š</strong>${day.meals}</p>
                        <p><strong>äº¤é€šï¼š</strong>${day.transport}</p>
                    </div>
                `;
            });

            detailsHTML += '<h4>æ—…è¡Œå°è´´å£«ï¼š</h4><ul>';
            data.tips.forEach(tip => {
                detailsHTML += `<li>${tip}</li>`;
            });
            detailsHTML += '</ul></div>';

            // æ¸²æŸ“ç»“æœ
            document.getElementById('flowchart').innerHTML = `
                <h2>AIè§„åˆ’ç»“æœ</h2>
                <div class="mermaid">${mermaidCode}</div>
                ${detailsHTML}
            `;

            // é‡æ–°åˆå§‹åŒ–Mermaidæ¸²æŸ“
            mermaid.init();
        }
    </script>
</body>
</html>